image: pagmo/ubuntu:v1

pagmo-gcc:
  script:
    - mkdir build
    - cd build
    - cmake -DCMAKE_CXX_FLAGS=--coverage -DCMAKE_BUILD_TYPE=Debug -DBUILD_TESTS=ON -DBUILD_TUTORIALS=ON ..
    - make -j4
    - make test
    # - wget https://codecov.io/bash -O codecov.sh
    # - chmod +x codecov.sh
    # - ./codecov.sh -t ca222632-02f3-4603-b2d6-7e1b3d3149e4

pagmo-clang:
  script:
    - mkdir build
    - cd build
    - CXX=clang++ CC=clang cmake -DCMAKE_BUILD_TYPE=Debug -DBUILD_TESTS=ON -DBUILD_TUTORIALS=ON ..
    - make -j4
    - make test

pygmo-clang-python3:
  script:
    - mkdir build
    - cd build
    - CXX=clang++ CC=clang cmake -DCMAKE_BUILD_TYPE=Debug -DBUILD_PYGMO=ON -DCMAKE_INSTALL_PREFIX=/usr -DPYTHON_EXECUTABLE=/usr/bin/python3 -DBoost_PYTHON_LIBRARY_DEBUG=/usr/lib/x86_64-linux-gnu/libboost_python-py35.so  ..
    - make -j4
    - make install
    - python3 -c "import pygmo.test; pygmo.test.run_test_suite()"

pages:
  script:
    - mkdir build
    - cd build
    - CXX=clang++ CC=clang cmake -DCMAKE_BUILD_TYPE=Debug -DBUILD_PYGMO=ON -DCMAKE_INSTALL_PREFIX=/usr -DPYTHON_EXECUTABLE=/usr/bin/python3 -DBoost_PYTHON_LIBRARY_DEBUG=/usr/lib/x86_64-linux-gnu/libboost_python-py35.so  ..
    - make -j4
    - make install
    - cd ../doc/sphinx
    - ./compile.sh
    - mv _build/html ../../public/
  artifacts:
    paths:
    - public
  only:
    - master
